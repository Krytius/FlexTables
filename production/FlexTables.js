/**
 * FlexTables
 * @version: 0.0.1
 * @author: Elvis Ferreira Coelho (elviscoelho.net)
 * Date criation: 29/01/2014
 */
function Grid(a){var b,c=this,d=new GridElement,e=new GridEvent,f=new GridMark,g=new GridManipulate,h=document.getElementById(a),i={},j=[],k=[],l=[],m=[],n=0,o=2,p=1e9;this.init=function(a){q(a),r()};var q=function(a){i=a,d.init(a),e.init(a),f.init(a),g.init(h,i,j,k,l,m)},r=function(){if(j.length>0){if(!(k.length>0||n>=o))return n++,void setTimeout(function(){console.log(idioma[2]),r()},30);s(),t(),u(i)}else setTimeout(function(){console.log(idioma[1]),r()},300)};this.setWidthColums=function(a){for(var b=a.length,c=h.offsetWidth-17,d=0,e=0,f=0;b>f;f++)"*"===a[f]?d++:c-=parseInt(a[f]);e=c/d;for(var f=0;b>f;f++)k.push("*"===a[f]?e:parseInt(a[f]))},this.setWidthColumsPercent=function(a){for(var b=a.length,c=h.offsetWidth-17,d=h.offsetWidth,e=0,f=0,g=0;b>g;g++)if("*"===a[g])e++;else{var i=c*parseInt(a[g])/100;d-=i}f=d/e;for(var g=0;b>g;g++)k.push("*"===a[g]?f:c*parseInt(a[g])/100)};var s=function(){for(var a=j.length,b=h.offsetWidth-17,c=b/a,d=0;a>d;d++)k.push(c)};this.setColums=function(a){j=a},this.setColumsType=function(a){l=a},this.setColumsEvents=function(a){m=a};var t=function(){var a=j.length,b=x("div");b.className="mw-header";var d=x("table");d.style.width=h.offsetWidth-17+"px";for(var f=x("tr"),g=0;a>g;g++){var m=x("td");m.width=k[g],m.setAttribute("data-id",g),m.setAttribute("type-coluna",l[g]),m.className="mw-header-td",m.onclick=function(){e.ordenar(this,i,function(a){c.refreshGrid(a)})};var n=x("div");n.className="mw-header-td-div",n.innerHTML=j[g],m.appendChild(n),f.appendChild(m)}d.appendChild(f),b.appendChild(d),h.appendChild(b)},u=function(a){var b=j.length,e=a.rows.length,g=x("div");g.className="mw-content",g.style.height=h.offsetHeight-42+"px",g.tabIndex="1",g.onkeydown=f.movimentLine;var l=x("table");l.style.width=h.offsetWidth-17+"px";for(var n=0;e>n;n++){var o=x("tr");o.className="mw-content-tr",o.setAttribute("linha-id",n),o.setAttribute("data-id",a.rows[n].id),o.onclick=f.selectRow;for(var p=0;b>p;p++){var q=x("td");q.className="mw-content-td",q.setAttribute("colum-id",p),q.width=k[p];var r=x("div");r.className="mw-content-td-div",r.innerHTML=a.rows[n].data[p],d.elementEvent(r,m[p],function(a){i=a}),q.appendChild(r),o.appendChild(q)}l.appendChild(o)}l.appendChild(o),g.appendChild(l),h.appendChild(g);var s={addRow:c.addRow};f.parametrosPaginacao(g,s)};this.addRow=function(a){var b=j.length,c=!1;a.itensColunas&&a.dataId&&(c=!0,i.rows.push({id:a.dataId,data:a.itensColunas}),q(i));var e=x("tr");e.className="mw-content-tr",e.setAttribute("linha-id",parseInt(h.childNodes[1].childNodes[0].childNodes.length)),e.onclick=f.selectRow,c?e.setAttribute("data-id",parseInt(a.dataId)):e.setAttribute("data-id","-1");for(var g=0;b>g;g++){var n=x("td");n.className="mw-content-td",n.setAttribute("colum-id",g),n.width=k[g];var o=x("div");o.className="mw-content-td-div",o.innerHTML=c?a.itensColunas[g]:"str"===l[g]?idioma.newRow:idioma.newRowNumber,d.elementEvent(o,m[g],function(a){q(a)}),n.appendChild(o),e.appendChild(n)}var r=w(".mw-content table");return c?(r.insertBefore(e,r.childNodes[a.position]),h.childNodes[1].scrollTop=42*a.position-42,f.selectionRowForce(e)):(r.appendChild(e),h.childNodes[1].scrollTop=r.offsetHeight),p++,e},this.deleteRow=function(a){var d=w(".mw-content table"),e=d.childNodes[a].getAttribute("data-id");d.removeChild(d.childNodes[a]),i.rows.splice(a,1),c.refreshGrid(i),q(i),b&&b(parseInt(a),parseInt(e))},this.deleteRowId=function(a){var d=w('tr.mw-content-tr[data-id="'+a+'"]').getAttribute("linha-id");i.rows.splice(d,1),c.refreshGrid(i),q(i),b&&b(parseInt(d),parseInt(a))},this.getRowSelectedId=function(){var a=f.getRowSelect();return a.idSelect},this.getRowSelected=function(){var a=f.getRowSelect();return a.rowSelect},this.setMonitorEvents=function(a,b){switch(a){case"onEdit":d.setCallbackOnEdit(b);break;case"onKeyPress":f.setCallbackOnKeyPress(b);break;case"onDeleteRow":v(b)}},this.refreshGrid=function(a){q(a);var b=w(".mw-content");h.removeChild(b),u(a)};var v=function(a){b=a},w=function(a){return document.querySelectorAll(a)[0]},x=function(a){return document.createElement(a)}}function GridElement(){var a,b,c,d=1e9;this.init=function(b){a=b},this.elementEvent=function(a,c,d){switch(c){case"edit":a.ondblclick=function(){b=d,e(a,"text")};break;case"number":a.ondblclick=function(){b=d,e(a,"number")}}};var e=function(a,d){var h=a.innerHTML,i=parseInt(a.parentNode.parentNode.getAttribute("linha-id")),j=parseInt(a.parentNode.parentNode.getAttribute("data-id")),k=parseInt(a.parentNode.getAttribute("colum-id"));if(-1===j)return void f(a,d);var l=document.createElement("input");l.type=d,l.className="mw-content-text",l.value=h,l.onblur=function(){var d=this.value;a.innerHTML=this.value,a.ondblclick=function(){e(a)},b(g(h,d,k,i,j)),c&&c(h,d,k,i,j)},l.onkeydown=function(d){var f=this.value;13===d.keyCode?(this.onblur=null,a.innerHTML=f,a.ondblclick=function(){e(a)},b(g(h,f,k,i,j)),c&&c(h,f,k,i,j)):27===d.keyCode&&(this.onblur=null,a.innerHTML=h,a.ondblclick=function(){e(a)},b(g(h,h,k,i,j)),c&&c(h,h,k,i,j))},a.innerHTML="",a.appendChild(l),l.focus(),a.ondblclick=null},f=function(b,c){var f=b.parentNode.parentNode,g=f.childNodes.length;f.setAttribute("data-id",d);for(var h={id:d,data:[]},i=0;g>i;i++)h.data.push(f.childNodes[i].childNodes[0].innerHTML);a.rows.push(h),d++,e(b,c)};this.setCallbackOnEdit=function(a){c=a};var g=function(b,c,d,e,f){return b===c?a:(parseInt(a.rows[e].id)===f&&(a.rows[e].data[d]=c),a)}}function GridEvent(){var a,b={id:"",ordenacao:""};this.init=function(b){a=b},this.ordenar=function(a,d,e){var f=a.getAttribute("data-id"),h=a.getAttribute("type-coluna"),i=b.id,j=b.ordenacao;if(i===f&&"ASC"===j?b.ordenacao="DESC":i===f&&"DESC"===j?b.ordenacao="ASC":(b.ordenacao="ASC",b.id=f),g("#ordenacao[data-id='"+f+"']")){var k=document.getElementById("ordenacao");k.className=b.ordenacao}else{if(i!==f&&i){var l=g("#ordenacao[data-id='"+i+"']"),m=l.parentNode;m.removeChild(l)}var n=document.createElement("div");n.className=b.ordenacao,n.id="ordenacao",n.setAttribute("data-id",f),a.appendChild(n)}var o=c(d,h,f);e(o)};var c=function(a,b,c){return a.rows.sort(function(a,g){return"str"===b?d(a.data[c],g.data[c]):"flt"===b?e(a.data[c],g.data[c]):"int"===b?f(a.data[c],g.data[c]):void 0}),a},d=function(a,c){var d=a.toLowerCase(),e=c.toLowerCase();if("ASC"===b.ordenacao){if(e>d)return-1;if(d>e)return 1}else{if(e>d)return 1;if(d>e)return-1}return 0},e=function(a,c){return"ASC"===b.ordenacao?parseFloat(a)-parseFloat(c):parseFloat(c)-parseFloat(a)},f=function(a,c){return"ASC"===b.ordenacao?parseInt(a)-parseInt(c):parseInt(c)-parseInt(a)},g=function(a){return document.querySelectorAll(a)[0]}}function GridManipulate(){var a,b={},c=[],d=[],e=[],f=[];this.init=function(g,h,i,j,k,l){a=g,b=h,c=i,d=j,e=k,f=l}}function GridMark(){var a,b,c,d,e=0,f=0,g={};this.init=function(b){a=b},this.getLinhaAnterior=function(){return b},this.setLinhaAnterior=function(a){b=a},this.getRowSelect=function(){return c?{rowSelect:c,idSelect:n('tr.mw-content-tr[linha-id="'+c+'"]').getAttribute("data-id")}:{rowSelect:null,idSelect:null}},this.selectRow=function(){if(b){var a=n('tr.mw-content-tr[linha-id="'+b+'"]');a.className=a.className.replace(" select","")}c=this.getAttribute("linha-id"),this.className+=" select",b=c},this.selectionRowForce=function(a){if(b){var d=n('tr.mw-content-tr[linha-id="'+b+'"]');d.className=d.className.replace(" select","")}c=a.getAttribute("linha-id"),a.className+=" select",b=c},this.parametrosPaginacao=function(a,b){g=b;var c=a.childNodes[0].childNodes.length,d=a.offsetHeight,h=a.childNodes[0].offsetHeight,i=Math.floor(h/d)+1,j=Math.floor(c/i);e=j,f=d};var h=function(a,b){return 0>a?!0:a>parseInt(b.childNodes.length-1)?!0:!1},i=function(a){if(b){var d=n('tr.mw-content-tr[linha-id="'+b+'"]');d.className=d.className.replace(" select","")}c=a.getAttribute("linha-id"),a.className+=" select",b=c},j=function(a){var b=a.childNodes[0].childNodes.length,c=a.childNodes[0];a.scrollTop=c.offsetHeight,i(c.childNodes[b-1])},k=function(a){var b=a.childNodes[0];a.scrollTop=0,i(b.childNodes[0])},l=function(a){var b=a.childNodes[0];h(parseInt(c)-1,b)||i(b.childNodes[parseInt(c)-1])},m=function(a){var b=a.childNodes[0];return h(parseInt(c)+1,b)?void(d||i(g.addRow(a))):void i(b.childNodes[parseInt(c)+1])};this.movimentLine=function(a){d?(d(a.keyCode,a.ctrlKey,a.shiftKey,a.altKey),38===a.keyCode?l(this):40===a.keyCode&&m(this)):a.ctrlKey&&38===a.keyCode?k(this):a.ctrlKey&&40===a.keyCode?j(this):38===a.keyCode?l(this):40===a.keyCode&&m(this)},this.setCallbackOnKeyPress=function(a){d=a};var n=function(a){return document.querySelectorAll(a)[0]}}