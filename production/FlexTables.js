/**
 * FlexTables
 * @version: 0.0.1
 * @author: Elvis Ferreira Coelho (elviscoelho.net)
 * Date criation: 11/02/2014
 */
function Grid(a){var b,c,d=this,e=new GridElement,f=new GridEvent,g=new GridMark,h=new GridContextMenu,i=new GridFilter,j=document.getElementById(a),k={},l={},m=[],n=[],o=[],p=[],q=[],r=[],s=[],t=0,u=2,v=1e9;this.init=function(a){w(a),y()};var w=function(a){k=a,i.init(j,a,m,o,D),e.init(a,r,o,p),f.init(a,p),g.init(a),h.init(a,q,g.selectionRowForce),c&&c(a)},x=function(a){l=a,f.init(a,p),g.init(a),h.init(a,q,g.selectionRowForce)},y=function(){if(m.length>0){if(!(n.length>0||t>=u))return t++,void setTimeout(function(){console.log(idioma[2]),y()},30);z(),A(),B(),C(k)}else setTimeout(function(){console.log(idioma[1]),y()},300)};this.setWidthColums=function(a){for(var b=a.length,c=j.offsetWidth-17,d=0,e=0,f=0;b>f;f++)"*"===a[f]?d++:c-=parseInt(a[f]);e=c/d;for(var f=0;b>f;f++)n.push("*"===a[f]?e:parseInt(a[f]))},this.setWidthColumsPercent=function(a){for(var b=a.length,c=j.offsetWidth-17,d=j.offsetWidth,e=0,f=0,g=0;b>g;g++)if("*"===a[g])e++;else{var h=c*parseInt(a[g])/100;d-=h}f=d/e;for(var g=0;b>g;g++)n.push("*"===a[g]?f:c*parseInt(a[g])/100)};var z=function(){for(var a=m.length,b=j.offsetWidth-17,c=b/a,d=0;a>d;d++)n.push(c)};this.setColums=function(a){m=a},this.setColumsType=function(a){o=a},this.setColumsMask=function(a){r=a},this.setColumsEvents=function(a){p=a},this.setContextMenu=function(a){q=a},this.setColumsFilter=function(a){s=a};var A=function(){if(s.length>0){for(var a=m.length,b=[],c=0;a>c;c++)s[c].status&&b.push([s[c],c]);i.setColumsFilter(b),i.constructFilter()}},B=function(){var a=m.length,b=H("div");b.className="mw-header";var c=H("table");c.style.width=j.offsetWidth-17+"px";for(var d=H("tr"),e=0;a>e;e++){var g=H("td");g.width=n[e],g.setAttribute("data-id",e),g.setAttribute("type-coluna",o[e]),g.className="mw-header-td",g.onclick=function(){f.ordenar(this,function(a){D(a)})};var h=H("div");h.className="mw-header-td-div",h.innerHTML=m[e],g.appendChild(h),d.appendChild(g)}c.appendChild(d),b.appendChild(c),j.appendChild(b)},C=function(a){var b=m.length,c=a.rows.length,f=H("div");f.className="mw-content",f.style.height=j.offsetHeight-42-(i.getColumsFilter().length>0?25:0)+"px",f.tabIndex="1",f.onkeydown=g.movimentLine;var k=H("table");k.style.width=j.offsetWidth-17+"px",q.length>0&&(window.onclick=g.removeContext);for(var l=0;c>l;l++){var r=H("tr");r.className="mw-content-tr",r.setAttribute("linha-id",l),r.setAttribute("data-id",a.rows[l].id),r.onclick=g.selectRow,q.length>0&&(r.oncontextmenu=h.vicContextMenu);for(var s=0;b>s;s++){var t=H("td");t.className="mw-content-td",t.setAttribute("colum-id",s),t.width=n[s];var u=e.createColumType(p[s],a.rows[l].data[s],n[s],s);e.elementEvent(u,p[s],o[s],function(a){w(a)}),t.appendChild(u),r.appendChild(t)}k.appendChild(r)}k.appendChild(r),f.appendChild(k),j.appendChild(f);var v={addRow:d.addRow};g.parametrosPaginacao(f,v)};this.addRow=function(a){var b=m.length,c=!1;a.itensColunas&&a.dataId&&(c=!0,k.rows.push({id:a.dataId,data:a.itensColunas}),w(k));var d=H("tr");d.className="mw-content-tr",d.setAttribute("linha-id",parseInt(G("div.mw-content").childNodes[0].childNodes.length)),d.onclick=g.selectRow,c?d.setAttribute("data-id",parseInt(a.dataId)):d.setAttribute("data-id","-1");for(var f=0;b>f;f++){var h=H("td");h.className="mw-content-td",h.setAttribute("colum-id",f),h.width=n[f];var i;i=c?a.itensColunas[f]:"str"===o[f]?idioma.newRow:"sle"===o[f]?k.rows[0].data[f]:idioma.newRowNumber;var l=e.createColumType(p[f],i,n[f]-10,f);e.elementEvent(l,p[f],o[f],function(a){w(a)}),h.appendChild(l),d.appendChild(h)}var q=G(".mw-content table");return c?(q.insertBefore(d,q.childNodes[a.position]),j.childNodes[1].scrollTop=42*a.position-42,g.selectionRowForce(d)):(q.appendChild(d),j.childNodes[1].scrollTop=q.offsetHeight),v++,d},this.deleteRow=function(a){var c=G(".mw-content table"),e=G(".mw-content").scrollTop,f=c.childNodes[a].getAttribute("data-id");c.removeChild(c.childNodes[a]),k.rows.splice(a,1),d.refreshGrid(k),w(k),G(".mw-content").scrollTop=e,a===g.getLinhaAnterior()&&g.setLinhaAnterior(null),b&&b(parseInt(a),parseInt(f))},this.deleteRowId=function(a){var c=G('tr.mw-content-tr[data-id="'+a+'"]').getAttribute("linha-id"),e=G(".mw-content").scrollTop;k.rows.splice(c,1),d.refreshGrid(k),w(k),G(".mw-content").scrollTop=e,c===g.getLinhaAnterior()&&g.setLinhaAnterior(null),b&&b(parseInt(c),parseInt(a))},this.getRowSelectedId=function(){var a=g.getRowSelect();return a.idSelect},this.getRowSelected=function(){var a=g.getRowSelect();return a.rowSelect},this.setMonitorEvents=function(a,b){switch(a){case"onEdit":e.setCallbackOnEdit(b);break;case"onCheck":e.setCallbackOnCheck(b);break;case"onKeyPress":g.setCallbackOnKeyPress(b);break;case"onDeleteRow":E(b);break;case"onObject":F(b)}},this.refreshGrid=function(a){w(a);var b=G(".mw-content");j.removeChild(b),C(a)};var D=function(a){var b=G(".mw-content");j.removeChild(b),C(a),x(a)},E=function(a){b=a},F=function(a){c=a},G=function(a){return document.querySelectorAll(a)[0]},H=function(a){return document.createElement(a)}}function GridContextMenu(){var a,b={},c=[],d=0,e=0;this.init=function(d,e,f){b=d,c=e,a=f},this.vicContextMenu=function(b){b.preventDefault(),d=this.getAttribute("linha-id"),e=this.getAttribute("data-id"),a(this),f(b.pageY,b.pageX)};var f=function(a,b){var d=h(".mw-content"),e=i("div"),f=0,j=0,k=0;e.className="mw-content-context-menu",e.style.top=a+"px",e.style.left=b+"px";for(var l=0;l<c.length;l++){var m=c[l];f+=30;var n=i("div");if(n.className="mw-context-menu",n.setAttribute("menu-id",l),n.onclick=g,m.icon){k=30;var o=i("div");o.className="mw-icon",o.style.backgroundImage="url("+m.icon+")",n.appendChild(o)}j<m.name.length&&(j=m.name.length);var p=i("div");p.className="mw-text",p.innerHTML=m.name,p.style.width=10*j+"px",n.appendChild(p),e.appendChild(n)}e.style.width=10*j+20+k+"px",e.style.height=f+"px",d.appendChild(e)},g=function(){var a=h(".mw-content"),b=this.getAttribute("menu-id");a.removeChild(this.parentNode),c[b].callback(d,e)},h=function(a){return document.querySelectorAll(a)[0]},i=function(a){return document.createElement(a)}}function GridElement(){var a,b,c,d,e=1e9,f=[],g=[],h=[],i=[],j=0;this.init=function(b,c,d,e){a=b,g=c,f=d,h=e},this.createColumType=function(a,b,c,d){var e;switch(j=c-10,a){case"edit":case"number":e=k(b);break;case"check":e=m(b);break;case"select":e=l(b,d);break;default:e=k(b)}return e};var k=function(a){var b=y("div");return b.className="mw-content-td-div",b.style.width=j+"px",b.innerHTML=a,b.setAttribute("title",a),b},l=function(a){var b=y("div");return b.className="mw-content-td-div",b.style.width=j+"px",b.innerHTML=a.itens[a.selected],b.setAttribute("title",a.itens[a.selected]),b},m=function(a){var b=y("div");return b.className="mw-content-td-check",b.className+=parseInt(a)?" enabled":" disabled",b};this.elementEvent=function(a,c,d,e){switch(c){case"edit":case"number":a.ondblclick=function(){b=e,n(a,"text",d)};break;case"select":a.ondblclick=function(){b=e,r(a)};break;case"check":a.onclick=function(){b=e,q(a)}}};var n=function(a,b){var c=a.innerHTML,d=parseInt(a.parentNode.parentNode.getAttribute("linha-id")),e=parseInt(a.parentNode.parentNode.getAttribute("data-id")),f=parseInt(a.parentNode.getAttribute("colum-id"));if(-1===e)return void p(a,b);var h=document.createElement("input");h.type=b,h.className="mw-content-text",h.value=c,h.onblur=function(){var b=this.value;o(a,b,c,f,d,e)},h.onkeyup=function(b){var h=this.value;13===b.keyCode?(this.onblur=null,o(a,h,c,f,d,e)):27===b.keyCode?(this.onblur=null,o(a,c,c,f,d,e)):(46!==b.keyCode||8!==b.keyCode)&&g.length>0&&u(this)},a.innerHTML="",a.appendChild(h),h.focus(),a.ondblclick=null},o=function(a,d,e,f,g,h){a.innerHTML=d,a.setAttribute("title",d),a.ondblclick=function(){n(a)},b(x(e,d,f,g,h)),c&&c(e,d,f,g,h)},p=function(b,c){var d=b.parentNode.parentNode,f=d.childNodes.length;d.setAttribute("data-id",e),d.setAttribute("linha-id",a.rows.length);for(var g={id:e,data:[]},i=0;f>i;i++)g.data.push("select"!==h[i]?d.childNodes[i].childNodes[0].innerHTML:a.rows[0].data[i]);a.rows.push(g),e++,n(b,c)},q=function(a){var c,e,f=a.className.split(" ")[1],g=a.parentNode.parentNode.getAttribute("data-id"),h=a.parentNode.parentNode.getAttribute("linha-id"),i=a.parentNode.getAttribute("colum-id");"enabled"===f?(a.className=a.className.replace("enabled","disabled"),c=1,e=0):(a.className=a.className.replace("disabled","enabled"),c=0,e=1),b(x(c,e,i,h,g)),d&&d(e?!0:!1,parseInt(i),parseInt(h),parseInt(g))},r=function(b){var c=b.parentNode,d=parseInt(b.parentNode.parentNode.getAttribute("linha-id")),e=parseInt(b.parentNode.parentNode.getAttribute("data-id")),f=parseInt(b.parentNode.getAttribute("colum-id"));if(-1===e)return void t(b);var g=a.rows[d].data[f],h=g.itens[g.selected],i=y("label"),j=y("select");j.className="mw-content-td-select";for(var k=0;k<g.itens.length;k++){var l=y("option");l.innerHTML=g.itens[k],l.value=k,l.selected=k===g.selected?!0:!1,j.appendChild(l)}j.onblur=function(){var a={linhaId:d,dataId:e,colum:f,text:h,valor:this.value};this.onchange=null,s(c,a)},j.onchange=function(){var a={linhaId:d,dataId:e,colum:f,text:h,valor:this.value};this.onblur=null,s(c,a)},c.innerHTML="",i.appendChild(j),c.appendChild(i),j.focus(),c.ondblclick=null},s=function(d,e){var f={};a.rows[e.linhaId]?f={selected:parseInt(e.valor),itens:a.rows[e.linhaId].data[e.colum].itens}:(f={selected:parseInt(e.valor),itens:i[e.colum].itens},t(d)),d.innerHTML="";var g=l(f);g.ondblclick=function(){r(g)},d.appendChild(g),b(x(e.text,f,e.colum,parseInt(e.linhaId),e.dataId)),c&&c(e.text,a.rows[e.linhaId].data[e.colum].itens[e.valor],e.colum,e.linhaId,e.dataId)},t=function(b){var c=b.parentNode.parentNode,d=c.childNodes.length;c.setAttribute("data-id",e);for(var f={id:e,data:[]},g=0;d>g;g++)f.data.push("select"!==h[g]?c.childNodes[g].childNodes[0].innerHTML:a.rows[0].data[g]);a.rows.push(f),e++,r(b)},u=function(a){var b=a.parentNode.parentNode.getAttribute("colum-id");"not"===g[b]?w(f[b],a):v(g[b],a)},v=function(a,b){MaskInput(a,b)},w=function(a,b){switch(a){case"int":MaskPadrao("9",b);break;case"flt":MaskPadrao("9.9",b);break;case"mon":MaskPadrao("R$9.9",b);break;default:MaskPadrao("a",b)}};this.setCallbackOnEdit=function(a){c=a},this.setCallbackOnCheck=function(a){d=a};var x=function(b,c,d,e,f){return b===c?a:(parseInt(a.rows[e].id)===parseInt(f)&&(a.rows[e].data[d]=c),a)},y=function(a){return document.createElement(a)}}function GridEvent(){var a,b={id:"",ordenacao:""},c=[],d=null,e=null;this.init=function(b,f){a=b,c=f,d=null,e=null},this.ordenar=function(g,h){var i=g.getAttribute("data-id"),k=g.getAttribute("type-coluna"),l=b.id,m=b.ordenacao;if("select"!==c[parseInt(i)]){if(l===i&&"ASC"===m?b.ordenacao="DESC":l===i&&"DESC"===m?b.ordenacao="ASC":(b.ordenacao="ASC",b.id=i),j("#ordenacao[data-id='"+i+"']")){var n=document.getElementById("ordenacao");n.className=b.ordenacao}else{if(l!==i&&l){var o=j("#ordenacao[data-id='"+l+"']"),p=o.parentNode;p.removeChild(o)}var q=document.createElement("div");q.className=b.ordenacao,q.id="ordenacao",q.setAttribute("data-id",i),g.appendChild(q)}var r=f(a,k,i);!d&&"ASC"===b.ordenacao||i!==l&&"ASC"===b.ordenacao?(d=r,h(d)):d&&"ASC"===b.ordenacao?h(d):!e&&"DESC"===b.ordenacao||i!==l&&"DESC"===b.ordenacao?(e=r,h(e)):e&&"DESC"===b.ordenacao&&h(e)}};var f=function(a,b,c){return a.rows.sort(function(a,d){return"str"===b?g(a.data[c],d.data[c]):"flt"===b?h(a.data[c],d.data[c]):"int"===b?i(a.data[c],d.data[c]):void 0}),a},g=function(a,c){var d=a.toLowerCase(),e=c.toLowerCase();if("ASC"===b.ordenacao){if(e>d)return-1;if(d>e)return 1}else{if(e>d)return 1;if(d>e)return-1}return 0},h=function(a,c){return"ASC"===b.ordenacao?parseFloat(a)-parseFloat(c):parseFloat(c)-parseFloat(a)},i=function(a,c){return"ASC"===b.ordenacao?parseInt(a)-parseInt(c):parseInt(c)-parseInt(a)},j=function(a){return document.querySelectorAll(a)[0]}}function GridFilter(){var a,b,c=this,d={},e=[],f=[],g=[],h=[],i={rows:[]},j={};this.init=function(c,g,h,i,j){a=c,d=g,e=h,f=i,b=j},this.setColumsFilter=function(a){g=a},this.getColumsFilter=function(){return g},this.constructFilter=function(){var b=s("div");b.className="mw-filter",b.style.width=a.offsetWidth+"px",b.style.height="25px";var c=k(),d=l(c),e=m();b.appendChild(d),b.appendChild(e),a.appendChild(b)};var k=function(){return a.offsetWidth-225},l=function(a){var b=g.length,c=a/b;c>150&&(c=150);var d=s("div");d.className="mw-selects",d.style.width=a+"px";for(var f=0;b>f;f++){var h=s("div");h.className="mw-buttons",h.setAttribute("filtro-id",f),h.setAttribute("colum-id",g[f][1]),h.setAttribute("title",e[g[f][1]]),h.style.width=c+"px",h.onclick=n;var i=s("i");i.className="mw-icon",i.style.backgroundImage="url("+g[f][0].icon+")";var j=s("span");j.className="mw-text",j.style.width=c-40+"px",j.innerHTML=e[g[f][1]],h.appendChild(i),h.appendChild(j),d.appendChild(h)}return d},m=function(){var a=s("div");a.className="mw-search",a.style.width="225px",a.onclick=o;var b=s("input");b.className="mw-filter-input",b.type="text",b.onkeyup=p;var c=s("div");return c.className="mw-filter-div",a.appendChild(b),a.appendChild(c),a},n=function(){var a=this.getAttribute("colum-id"),b=this.getAttribute("filtro-id");if(this.className+=" selected",j.columId){var c=this.parentNode.childNodes[j.filtroId];c.className=c.className.replace(" selected","")}r(".mw-filter-input").focus(),j.columId=a,j.filtroId=b},o=function(){j.columId||c.forceFilterActive(0),r(".mw-filter-input").focus()};this.forceFilterActive=function(a){if(j.columId){var b=r(".mw-filter .mw-selects").childNodes[j.filtroId];b.className=b.className.replace(" selected","")}var c=r(".mw-selects").childNodes[a];c.className+=" selected";var d=c.getAttribute("colum-id"),e=c.getAttribute("filtro-id");j.columId=d,j.filtroId=e};var p=function(a){if(13!==a.keyCode){for(var c=d.rows.length,e=[],f=0;c>f;f++)e.push(d.rows[f].data[j.columId].toLowerCase());if(h=[],e.filter(q),h.length>0){var g=h.length;i.rows=[];for(var f=0;g>f;f++)i.rows.push(d.rows[h[f]]);b(i)}else b(d)}},q=function(a,b){var c,d,e;switch(f[j.columId]){case"str":c=r(".mw-filter-input").value.toLowerCase(),d=-1!==a.search(c);break;case"int":c=parseInt(r(".mw-filter-input").value),d=parseInt(a)===c,e=!c;break;case"flt":c=parseFloat(r(".mw-filter-input").value),d=parseFloat(a)===c,e=!c}return d?void h.push(b):e?void(h=[]):void 0};this.clearFilter=function(){var a=r(".mw-filter .mw-selects").childNodes[j.filtroId];a&&(a.className=a.className.replace(" selected","")),i={},h=[],j={},r(".mw-filter-input").value=""};var r=function(a){return document.querySelectorAll(a)[0]},s=function(a){return document.createElement(a)}}function GridMark(){var a,b,c,d,e=this,f=0,g=0,h=0,i=0,j={};this.init=function(b){a=b},this.getLinhaAnterior=function(){return b},this.setLinhaAnterior=function(a){b=a},this.getRowSelect=function(){return c?{rowSelect:c,idSelect:r('tr.mw-content-tr[linha-id="'+c+'"]').getAttribute("data-id")}:{rowSelect:null,idSelect:null}},this.removeContext=function(){r(".mw-content div.mw-content-context-menu")&&r(".mw-content").removeChild(r(".mw-content div.mw-content-context-menu"))},this.selectRow=function(){if(b){var a=r('tr.mw-content-tr[linha-id="'+b+'"]');a&&(a.className=a.className.replace(" select","")),e.removeContext()}c=this.getAttribute("linha-id"),this.className+=" select",b=c,q("click")},this.selectionRowForce=function(a){if(b){var d=r('tr.mw-content-tr[linha-id="'+b+'"]');d.className=d.className.replace(" select",""),e.removeContext()}c=a.getAttribute("linha-id"),a.className+=" select",b=c,q("click")},this.parametrosPaginacao=function(a,b){j=b,e.configPaginacao()};var k=function(a,b){return 0>a?!0:a>parseInt(b.childNodes.length-1)?!0:!1},l=function(a){if(b){var d=r('tr.mw-content-tr[linha-id="'+b+'"]');d&&(d.className=d.className.replace(" select","")),e.removeContext()}c=a.getAttribute("linha-id"),a.className+=" select",b=c,q("keypress")},m=function(a){var b=a.childNodes[0].childNodes.length,c=a.childNodes[0];a.scrollTop=c.offsetHeight,l(c.childNodes[b-1])},n=function(a){var b=a.childNodes[0];a.scrollTop=0,l(b.childNodes[0])},o=function(a){var b=a.childNodes[0];k(parseInt(c)-1,b)||l(b.childNodes[parseInt(c)-1])},p=function(a){var b=a.childNodes[0];return k(parseInt(c)+1,b)?void(d||l(j.addRow(a))):void l(b.childNodes[parseInt(c)+1])};this.movimentLine=function(a){d?(d(a.keyCode,a.ctrlKey,a.shiftKey,a.altKey),38===a.keyCode?o(this):40===a.keyCode&&p(this)):a.ctrlKey&&38===a.keyCode?(a.preventDefault(),n(this)):a.ctrlKey&&40===a.keyCode?(a.preventDefault(),m(this)):38===a.keyCode?(a.preventDefault(),o(this)):40===a.keyCode&&(a.preventDefault(),p(this))},this.configPaginacao=function(){var a=r(".mw-content").offsetHeight,b=r(".mw-content table").offsetHeight;g=Math.floor(b/a),b/a>g&&(g+=1);var c=r(".mw-content table").childNodes.length;h=Math.floor(c/g),i=42*h};var q=function(a){f=Math.floor(c/h),"keypress"===a&&(r(".mw-content").scrollTop=f*i)};this.setCallbackOnKeyPress=function(a){d=a};var r=function(a){return document.querySelectorAll(a)[0]}}function MaskInput(a,b){var c=a,d=b,e=function(){{var a=f(),b=g(a);h(a,b)}},f=function(){var a=c.length;d.maxLength=a;for(var b=[],e=0;a>e;e++)b.push(k(c[e]));return b},g=function(a){for(var b=a.length,d=[],e=0;b>e;e++)a[e].test(1)||a[e].test("A")||a[e].test("a")||d.push({pos:e,"char":c[e]});return d},h=function(a,b){for(var c=d.value,e=d.value,f=e.length,g=(a.length,b.length),h=0;f>h;h++)for(var k=0;g>k;k++)h===b[k].pos&&e[h]!==b[k].char&&(c=j(b[k].pos,c,b[k].char));for(var h=0;h<c.length;h++){var l=a[h].test(c[h]);l||(c=i(h,c))}d.value=c},i=function(a,b){return b=b.slice(0,a)},j=function(a,b,c){return b.slice(0,a)+c+b.slice(a)},k=function(a){for(var b=a.length,c="",d=1,e="",f=0;b>f;f++)c===a[f]?d++:(d>1?e+="{"+d+"})":1!==d||"A"!==c&&"a"!==c&&"?"!==c&&"9"!==c?1===d&&"*"===c&&(e+="+)"):e+=")",c=a[f],e+="9"===c?"([0-9]":"A"===c?"([A-Z]":"a"===c?"([a-z]":"?"===c?"([A-Za-z]":"*"===c?"([A-Za-z0-9]":" "===c?"\\s":"\\"+c,d=1),f===b-1&&d>1?e+="{"+d+"})":f!==b-1||"A"!==c&&"a"!==c&&"?"!==c&&"9"!==c||1!==d?f===b-1&&1===d&&"*"===c&&(e+="+)"):e+=")";return new RegExp("^"+e+"$")};e()}function MaskPadrao(a,b){var c=a,d=b,e=function(){var a;switch(c){case"9":a=new RegExp(/^[0-9]+$/);break;case"9.9":case"R$9.9":a=new RegExp(/^([^A-Za-z]+)$/);break;default:a=new RegExp(/.+/)}f(a,c)},f=function(a,b){var c=d.value;if("R$9.9"!==b){for(var e=0;e<d.value.length;e++){var f=a.test(c[e]);f||(c=c.slice(0,e))}d.value=c}else{c=c.replace(idioma.moeda,"");for(var e=0;e<c.length;e++){var f=a.test(c[e]);f||(c=c.slice(0,e))}d.value=idioma.moeda+c}};e()}